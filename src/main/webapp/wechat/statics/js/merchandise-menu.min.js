+function(t){"use strict";var e=function(i,a){this.options=t.extend({},e.DEFAULTS,a),this.$elem=t(i),this.commodity={},this.init()};e.Version="0.0.1",e.DEFAULTS={url:void 0,data:void 0,method:"get",contentType:"application/json",dataType:"json",async:!0},e.prototype.add=function(t,e){var i,a,n;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{a=e.toString().split(".")[1].length}catch(t){a=0}return n=Math.pow(10,Math.max(i,a)),(this.mul(t,n)+this.mul(e,n))/n},e.prototype.sub=function(t,e){var i,a,n;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{a=e.toString().split(".")[1].length}catch(t){a=0}return n=Math.pow(10,Math.max(i,a)),(this.mul(t,n)-this.mul(e,n))/n},e.prototype.mul=function(t,e){var i=0,a=t.toString(),n=e.toString();try{i+=a.split(".")[1].length}catch(t){}try{i+=n.split(".")[1].length}catch(t){}return Number(a.replace(".",""))*Number(n.replace(".",""))/Math.pow(10,i)},e.prototype.div=function(t,e){var i,a,n=0,o=0;try{n=t.toString().split(".")[1].length}catch(t){}try{o=e.toString().split(".")[1].length}catch(t){}return i=Number(t.toString().replace(".","")),a=Number(e.toString().replace(".","")),this.mul(i/a,Math.pow(10,o-n))},e.prototype.init=function(){if(this.$header=t(".merchandise-top .weui-flex"),this.$cdiv=t(".commodity-shopping-cart"),this.options.url){var e=this;t.ajax({type:this.options.method,url:this.options.url,data:"application/json"===this.options.contentType&&"post"===this.options.method?JSON.stringify(this.options.data):this.options.data,dataType:this.options.dataType,async:this.options.async,success:function(i){i.success?e.options.data=i.data:(t.toast(i.message,"forbidden"),setTimeout(function(){history.back(-1)},2e3))},error:function(t){console.log(t)}})}return t.ajax({type:this.options.method,url:"/RailwayService/merchant/isServiceProviderOnline.do?stationId="+sessionStorage.stationId+"&serviceType="+sessionStorage.serviceType,dataType:this.options.dataType,success:function(t){t.success&&(sessionStorage.delivery=t.data)}}),this.renderMenu()},e.prototype.renderMenu=function(){var e=this,i=e.options.data;e.$header.append(t("#clone_hdiv").clone().text());var a=e.$header.find("img"),n=e.$header.find("h4"),o=e.$header.find("p#address"),s=e.$header.find("p#proc"),c=e.$header.find(".star-g"),d=String(i.merchant.evaluate).split("."),r="/RailwayService"+i.merchant.imageUrl;if(a.attr("src",r),n.text(i.merchant.name),s.html("公告:&nbsp;"+(i.merchant.announcement?i.merchant.announcement:"该商家暂无公告")),o.html("地址: &nbsp;"+(i.merchant.address?i.merchant.address:"商家暂未填写地址")),0!=d[0]){for(var p=0;p<d[0];++p)c.append('<i class="iconfont icon-xing1"></i>');d.length>1&&c.append('<i class="iconfont icon-banxing1"></i>')}else c.append("<span>暂无评分信息</span>");if(e.$header.append('<style>.merchandise-info-center:before{background: url("'+r+'") #000000}</style>'),0!=i.menu.length){e.$elem.append(t("#clone_fdiv").clone().text()),e.$elem.append(t("#clone_sdiv").clone().text());var l,u,h,m=e.$elem.find("ul"),_=e.$elem.find(".secondMenu");t.each(i.menu,function(){l=t("#clone_li").clone().text().replace(/__section-1__/g,this.category.productCategoryId).replace("__第一部分__",this.category.name),m.append(l),_.append(t("#clone_goods").clone().text().replace("__target__",this.category.productCategoryId).replace("__标题__",this.category.name).replace("__描述__",this.category.category?this.category.category:"")),u=_.find("div.weui-panel_access:last"),0==this.goods.length?u.append(t("#clone_good_bg").clone().text()):t.each(this.goods,function(){this&&(h=this.imageUrl?"/RailwayService"+this.imageUrl:"/RailwayService/wechat/statics/images/goods_empty.jpg",u.append(t("#clone_good").clone().text().replace("url",h).replace("__标题__",this.name.length>8?this.name.substr(0,8)+"...":this.name).replace("__内容__",this.introduction.length>10?this.introduction.substr(0,10)+"...":this.introduction).replace("__价格__",this.price?this.price:0).replace("__sales__",this.sales?this.sales:0).replace(/__商品id__/g,this.productId)))})})}else t(".merchandise-menu").css("bottom","0"),t("div.empty").show();e.$cdiv.append(t("#clone_shopCart").clone().text()),8003==e.options.data.merchant.status&&(e.$elem.find("div.btn-ctl").remove(),t("#num_0").hide(),t("#b_end").show()),this.$elem.on("click",'[data-name="add"],[data-name="reduce"]',function(){var i=t(this).data("name"),a=t(this).parents(".weui-panel__bd").data("id"),n=t(this).parents(".secondMenu").find('[data-id="'+a+'"]'),o=n.find("div[data-name=reduce]"),s=n.find("span[data-name=count]"),c=e.$cdiv.find("span.weui-badge"),d=e.$cdiv.find("#cost"),r="reduce"===i?-1:1,p=e.goods[a].price*r,l=Number(s[0].innerText)+1*r,u=Number(c.text())+1*r;0!=l?(o.fadeIn(500),s.text(l).fadeIn(500)):(o.fadeOut(100),s.fadeOut(100,function(){t(this).text(l)})),0!=u?(c.text(u).fadeIn(100),t("#num_0").hide(),t("#submit").show()):(c.fadeOut(100,function(){t(this).text(u)}),t("#submit").hide(),t("#num_0").show()),d.text(e.add(Number(d.text()),p)),"add"===i?a in e.commodity?e.commodity[a].num+=1:e.commodity[a]={num:1,data:e.goods[a]}:a in e.commodity&&(e.commodity[a].num-=1,0==e.commodity[a].num&&delete e.commodity[a])}).on("click",".secondMenu img,.secondMenu .weui-media-box__title,.secondMenu span.weui-media-box__desc",function(i){if(t(i.target).hasClass("btn_ctl")||t(i.target).hasClass("iconfont"))return!1;var a,n=t(this).parents(".goods-info").data("id"),o=e.goods[n];a=o.imageUrl?"/RailwayService"+o.imageUrl:"/RailwayService/wechat/statics/images/goods_empty2.jpg",t("body").append(t("#clone_popup").clone().text().replace("__标题__",o.name).replace("__副标题__",t(window).width()<=320?o.introduction.substr(0,16):o.introduction.substr(0,20)).replace("__价格__",o.price?o.price:0).replace("__sales__",o.sales?o.sales:0).replace(/__商品id__/g,n).replace("__url__",a));var s=t(".goods-popup-detail a");8003==e.options.data.merchant.status&&s.remove(),t("div.goods-popup-detail").fadeIn()}).on("click",".firstMenu li",function(){var e=t(".firstMenu li.active");return e[0]!=this&&(location.replace(t(this).find("a").attr("href")),e.removeClass("active"),t(this).addClass("active"),!1)}),e.$cdiv.on("click",'[data-toggle="show-shopping-detail"]',function(){return!t.isEmptyObject(e.commodity)&&(0!=t(".weui-actionsheet").length?t("div.weui-mask").click():void t.actions({title:t("#clone_detail_title").clone().text(),actions:function(){var i=[{text:t("#clone_detail_fee").clone().text().replace("__fee__",e.options.data.distributionCosts?e.options.data.distributionCosts:0)}];return t.each(e.commodity,function(e,a){i.push({text:t("#clone_detail").clone().text().replace("__商品名称__",a.data.name).replace("__价格__",a.data.price*a.num).replace(/__商品id__/g,e).replace("__数量__",a.num)})}),i}()}))}),t(document).on("click",'[data-name="sheet"]',function(){var i=t(this).data("type"),a="add"===i?t(this).prev():t(this).next(),n=t(this).parents(".weui-flex").find('[data-name="price"]'),o=t(this).parents(".weui-actionsheet__cell"),s=t(this).data("id"),c="reduce"===i?-1:1,d=Number(a.text())+1*c,r=e.add(Number(n.text()),e.commodity[s].data.price*c);if(0==d)return t(t('div.weui-panel__bd[data-id="'+s+'"]')[0]).find('div[data-name="reduce"]').click(),t.isEmptyObject(e.commodity)?t("div.weui-mask").click():o.remove();"reduce"==i?t(t('div.weui-panel__bd[data-id="'+s+'"]')[0]).find('div[data-name="reduce"]').click():t(t('div.weui-panel__bd[data-id="'+s+'"]')[0]).find('div[data-name="add"]').click(),n.text(r),a.text(d)}).on("click",'[data-name="clearAll"]',function(){t(".weui-mask").click(),setTimeout(function(){var i=t(".commodity-shopping-cart").css("z-index");t(".commodity-shopping-cart").css("z-index",2),t.confirm("您确定要清空购物车吗?","确认清空?",function(){t.each(e.commodity,function(e,i){for(var a=this.num-1;a>=0;a--)t(t('div[data-name="reduce"][data-id="'+e+'"]')[0]).click()}),t.ajax({url:"/RailwayService/order/changeShoppingCart.do",type:"post",contentType:e.options.contentType,data:JSON.stringify({merchantId:sessionStorage.merchantId,productList:[]}),dataType:e.options.dataType}),t.toast("购物车已清空!"),setTimeout(function(){t(".commodity-shopping-cart").css("z-index",i)},2500)},function(){t(".commodity-shopping-cart").css("z-index",i)})},300)}).on("click",'[data-name="pop-mask"]',function(){var e=t(".goods-popup-detail");0!=e.length&&e.remove()}).on("click",'[data-name="addToCart"]',function(){return t(t('div.weui-panel__bd[data-id="'+t(this).data("id")+'"]')[0]).find('div[data-name="add"]').click(),t("div.weui-mask").click()}).on("click",'[data-name="submit"]',function(){if(t(this).hasClass("btn-disabled"))return!1;t(".weui-mask").click();var i={merchantId:null,productList:[]};t.each(e.commodity,function(t,e){i.productList.push({productId:t,count:e.num}),i.merchantId=e.data.merchantId}),t.ajax({url:"/RailwayService/order/changeShoppingCart.do",type:"post",contentType:e.options.contentType,data:JSON.stringify(i),dataType:e.options.dataType,beforeSend:function(){t.showLoading()},success:function(i){t.hideLoading(),setTimeout(function(){i.success?(sessionStorage.shoppingCart=e.commodity,window.location.href="/RailwayService/wechat/payOrder.html"):t.toast(i.message,"forbidden")},1e3)},error:function(e){t.hideLoading(),t.toast(e.statusText,"forbidden")}})}).on("click","div.close",function(){t(".weui-mask").click()});var f={};t.each(e.options.data.menu,function(){this.goods&&t.each(this.goods,function(){this&&(f[this.productId]=this)})}),e.goods=f,this.shoppingCart(),_.scrollspy({target:"div.firstMenu",offset:0,init:!0}),sessionStorage.productId&&(t('div[data-id="'+sessionStorage.productId+'"] img:first').click(),sessionStorage.removeItem("productId"))},e.prototype.shoppingCart=function(){sessionStorage.shoppingCart&&t.each(JSON.parse(sessionStorage.shoppingCart),function(e,i){for(var a=0;a<i.num;++a)t('div[data-name="add"][data-id='+e+"] ").click()})},t.fn.menus=function(i){var a,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var o=t(this),s=o.data("rswc.menus"),c=t.extend({},e.DEFAULTS,o.data(),"object"==typeof i&&i);if("string"==typeof i){if(!s)return;a=s[i].apply(s,n)}if("object"==typeof i&&!i.url&&!i.data)throw new Error("menus required url or data");s||o.data("rswc.menus",s=new e(this,c))}),void 0===a?this:a},t.fn.menus.Constructor=e,t.fn.menus.version=e.Version,t.fn.menus.defaults=e.DEFAULTS}(jQuery);